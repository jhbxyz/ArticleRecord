# 协程

### 1.协程是什么

协程就是 Kotlin 官方提供的一套**线程封装的 API**，是一个线程框架

协程是什么，具体到代码中

> 启动一个协程可以使用 `launch` 或者 `async` 函数，协程其实就是这两个函数中闭包的代码块中**执行的具体代码**。

### 2.协程好在哪

方便，在一个代码块里，可以方便的多次进行线程切换

用同步的方式写异步的代码（非阻塞式挂起），看起来很方便

* 改变了**并发**操作的难度
* 两个并行请求写成上下两行
* 让复杂的**并发**代码，写起来变得简单且清晰，是协程的优势。

### 3.什么时候用协程

切线程或者指定线程的时候

* 后台执行任务

* 前台更新界面 

  > `withContext` 这个函数可以切换到指定的线程，并在闭包内的逻辑执行结束之后，自动把线程切回去继续执行
  >
  > 消除了并发代码在协作时的嵌套

### 4.suspend 关键字

代码执行到 `suspend` 函数的时候会『挂起』，并且这个『挂起』是非阻塞式的，它不会阻塞你当前的线程。

#### 4.1挂起的本质

本质：我们挂起的对象**是协程**

含义：切一个线程，会自动切换来的，线程切换

**挂起**：从当前线程挂起。换句话说，就是这个**协程**从正在执行它的**线程**上**脱离**。

> 线程：不再执行剩余的协程代码，跳出协程的代码块
>
> > 后台线程：无事可做，等待回收，或者执行别的后台任务
> >
> >  Android 的主线程：那它接下来就会继续回去工作：也就是一秒钟 60 次的界面刷新任务
>
> 协程：协程会从这个 `suspend` 函数开始继续往下执行，不过是在**指定的线程**。
>
> > 紧接着在 `suspend` 函数执行完成之后，协程为我们做的最爽的事就来了：会**自动帮我们把线程再切回来**
> >
> > 执行当初没有执行完的任务

#### 4.2.suspend 的意义？

 `suspend`，其实并不是起到把任何把协程挂起，或者说切换线程的作用。真正挂起协程这件事，是 Kotlin 的协程框架帮我们做的。

**它其实是一个提醒**

### 5.什么是「非阻塞式挂起」

「非阻塞式挂起」，其实就是在讲协程在挂起的同时切线程这件事情，不卡线程

> 这里说一下 Java 的线程，线程池也是非阻塞式

协程只是在写法上「看起来阻塞」，其实是「非阻塞」的，因为在协程里面它做了很多工作，其中有一个就是帮我们切线程。

### 6.协程与线程

一个**基于线程的上层框架**